eliminar - YouTube
https://www.youtube.com/watch?v=MpxTbfXVjSk

Transcript:
vimos la última sesión de laboratorio ya tiene como tres semanas alguien se acuerda qué vimos qué hicimos que estábamos haciendo oint bien Dani justamente de la sesión pasada decidimos bueno decidí separar las cosas porque Eh pues ya ven que pensé que me iba a faltar pensé que me iba a sobrar mucho tiempo y al contrario me faltó tiempo para explicar las cosas y de el ataque de diccionario lo vimos como superrápido y dije no no no tengo que volver a hacerlo bien porque no más no se está entendiendo y con los que
estamos justamente con los que estábamos en presencial les pregunté como de a ver la mera verdad se entendió y muchos me dijeron que ni siquiera sabían que era nunca habían ocupado secure shell ni administrado nada desde la terminal entonces dije voy a ir más despacito eh Gracias por lanzar las manos yaora pueden bajar a menos que tengan dudas No dudas adelante tienes dudas Cristian o la dejaste levantada Ah bueno cre no hayas Entonces en ese sentido lo separamos la práctica pasada se fue dos que es bastante interesante nos sacaron
la CP no lo vo a venir pero pero lo hiciera creo que las No todavía no está grabando emp a grabar creo que lo demás estuvo tranqu no encontrar laer era con los metadatos de la imagen ahí venía el GPS y lo podías Buscar lo de este la información relacionada al dominio tenemos una herramienta que se llama juis Ahí vi el registro del dominio ahí se podía consultar la fecha de creación y todo eso había otra cosa por ahí no no más eran esas dos no la foto lo del dominio esto interesante que muchos bueno algunos Encontraron la Puerta Roja
a través de Pinterest hicieron un rever Search en Pinterest y les dio y dije ah Ese no era el camino que estaba pensado pero interesante saberlo y ya después nuestra info pues ya básicamente nos estalquear un poquito sac información otra vez sacon el nombre de mi ex ya ya no es novedad Pero bueno alguien tiene alguna duda comentario queja sugerencia con esa parte hicimos todo bien muy sencillo deberíamos hacerlo más complicado Qué piensan bueno va gracias por los los tres
personas que me contestaron el plan para hoy es ahora s ver con más calma que es un ataque diccionario Ah ahora tengo que empar a grabar grabar va Ahora sí está grabando e vamos a retomar la plática que estábamos teniendo el laboratorio pasado conmigo acerca de un ataque de diccionario y esto tiene su motivación en cosas que pasen en la vida real por ejemplo tenemos este informe de Google Cloud horizons que es ya del año pasado de hecho acaba salir el nuevo parece me llegó por correo hace ratito o fishing ya no sé pero yo lo descargué esde este
año pasado pero la tendencia se repite no eh podemos ver en sus primeras s las primeras páginas que las credenciales eh Son el factor de más de la mayor más de la mitad de los incidentes en el primer cuarto del 2023 y la mayoría de las instrucciones empiezan así Lamentablemente y es por 54.
8 por por we or no password O sea a veces le dejan eh sin contraseñas o les dejan contraseñas muy débiles o muy reutilizadas Y eso es como el principal factor de compromiso en instancias en la nube o servicios en general lo cual no es buena idea no es únicamente de de Google Cloud por ejemplo también crowdstrike en sus reportes también dicen que que en este caso el 43 no creo Bueno lo estoy leyendo de aquí con ustedes justo en la diapositiva pero pues sí básicamente los seres humanos seguimos ocupando las credenciales por defecto no las cambiamos o ni siquiera
tenemos y así mandamos a producción y pues luego por ahí empiezan las inclusiones eh Hay una herramienta de Troy Hunt Por cierto no sé si ya les hab platicado de Ja pound algunos de ustedes los ocuparon para su tarea más que para los in más que nada para para presentar sobre algunos de nuestros correos electrónicos si estaban en algunas filtraciones no sé si alguien de aquí conozca que es Ja pound o lo está ocupando o lo ha ocupado alguna vez salena nos comenta que ya lo había ocupado antes eh Jonathan dice que no
estaría padre como ejercicio Emiliano dijo que hizo Exactamente eso para ver mis correos una forma de poder hacerlo y aunque aquí ya no estoy seguro que entre en osint es si tú pones tu correo electrónico acá Busca en muchas listas filtradas y en caso de haber una en las que estás pues simplemente te dice este correo está en esta lista nada más te dice Qué información está expuesta no te dice Cuáles son los datos Porque si no imaginas el regado que se haría entonces Los invito a que ocupen sus correos el institucional o el personal y vean si si
está filtrado en alguna en algún lugar no sé en mi caso son pocas las filtraciones y creo que no tienen mayor impacto pero sí tengo familia donde eh que está en las listas filtradas de vanorte de hace con información de hace como 5 años me parece vanorte sufrió una una vulneración importante mic disclosure entonces F pero por ahí nos dimos cuenta y era porque este familiar mío recibía como correos y porque el correo era el mismo que tenía en esa época como muy específicos hacia él con su nombre y con ciertas cosas válidas
entonces uno pensaba que s era como real pero cuando veías la demás parte los l que te dirigía y el remitente pues veías que no que era que no era legítimo de dónde salieron esos datos pues una filtración entonces Los invito a que chequen si alguien encuentra algo interesante pues ya al menos tiene como un poquito de más idea es lo que les quería comentar e otro Es sobre el gestor de contraseñas alguien ocupa algunos de estos dos creo que tampoco habamos hablado de esto pero justamente para no ocupar contraseñas
repetidas en todos los servicios necesitamos contraseñas únicas y robustas y como no somos buenos recordando eso hay Software que se encarga por nosotros como los gestores de contraseñas y aquí les presento como dos Eh bueno que ni siquiera se los presento yo es de un artículo de de New York Times Luis Manuel ocupa kipas que es otro los demás alguien todos los demás También ocupan ocupamos gestores de contraseñas o ocupamos la misma para todo o pequeñas variaciones dos personas K nos dicen que los escriben en un
cuaderno en una libreta también Cristian es de los míos que ocupa barden sar dice que en papelitos Aquí hay una opinión como como tal vez no muy popular pero depende el perfil de riesgo no veo tan mala idea que alguien las anote en una libreta o en un cuaderno lo buscan en internet muy seguramente les digan que bueno en algún artículo les voy a decir que es de lo peor que pueden hacer al lado de la computadora si es mala idea pero este depende el perfil de riesgo y los conocimientos técnicos de las personas puede ser puede no ser mala
idea tenerlas en una libreta que tenemos en la mente pero bueno entonces pues ya er como dos cosas que comentarles sobre la existencia de pound y gestores de contraseñas para los que no porque nada me en contaron como cinco personas de las 25k les invito a que investiguen que es un gestor de contraseñas y que lo utilicen para mejorar su postura de seguridad pero bueno regresando a lo que tenemos que ver el día de hoy qu es un ataque de Fuerza bruta o de diccionario eh un ataque de Fuerza bruta es un intento desde si Fer una contraseña un
nombre de usuario de Buscar una página web oculta o de descubrir la cla utilizada para si F un mensaje que consiste en aplicar el método de ensayo y error con la esperanza de dar con la combinación correcta una disculpa por el trailer que está de reversa aquí pero bueno eh la prueba de un ataque diccionario es una técnica que consiste en probar las palabras y contraseñas más usadas como 1 2 3 4 5 6 y sus variaciones ese tipo de ataque está basado en el hecho de que un gran número de usuari elige la misma contraseña para todo o contraseñas
débiles porque son más fáciles de recordar esto lo que estamos practicando utilizar contraseñas desde las debilidades más comunes que tenemos las personas entonces el ataque de fuerza bruta es al espacio de claves y prueba y el ataque de diccionario es con claves más probables probablemente est en un diccionario o en un Word que es lo que vamos a ver ahor hasta aquí todo bien gracias K eh Ahora vamos a ocupar secure shell Es un protocolo utilizado para establecer una conexión segura y cifrada entre dos dispositivos a través
de una red y obviamente es un objetivo común que da un primer acceso un dispositivo a la red se puede abusar y tener un acceso autorizado e habos platicado la vez pasada pero lo voy a repetir por los que no hayan estado es un protocolo utilizado para establecer una conexión segura y cifrada entre dos dispositivos a través de una red se usa comúnmente para el acceso remoto y la administración de servidores una de las características una de las características clave es uso descifrado para proteger los datos a medida que se
transmiten dispositivos esto nos ayuda a evitar el acceso no autorizado o que se intercepte información confidencial que vaya Viajando en claro a través de la red admite varios métodos de autenticación como la basada en contraseña o en llaves ahorita vamos a ver basada en contraseña y obviamente es fundamental proteger este servicio es un objetivo muy común para los actores de amenazas si se ve comprometido un atacante podría obtener acceso no autorizado a datos confidenciales o tomar el control de los dispositivos lo
que afecta directamente a la tra de la seguridad como lo podemos proteger debemos Deshabilitar el acceso para usuarios innecesarios aplicar con políticas de contraseña robustas autenticación por llaves limitar el acceso desde direcciones ips confiables y etcétera al final vamos a ver que tenemos varias formas este de hacer hardening y todas complementar esto también lo habamos visto la vez pasada que es el stack pueden revisar con calma tampoco es como super fundamental pero para tener un buen entendimiento de queé es lo que
está pasando también tenemos nuestro diagrama de cliente y servidor lo que pasa es esto que el cliente ha una conexión tcp al puerto 22 que es el por defecto de secure del servidor se ponen de acuerdo una versión de protocolo utilizar de acuerdo a las configuraciones de ambos servidor tiene su par par de llaves pública y Privada es es asimétrico el sistema envía la llave pública el cliente compare la llave Pública para ver que s sea con quien dice inter act and genera una clave deción aleatoria y un algoritmo
cifrado métrico y es el que van a utilizar para sus Comunicaciones y ya después empieza el proceso de autenticación Okay siempre hay que asegurarse de tener permiso Recuerden que el ataque de diccionario que vamos a hacer siempre hay que asegurarse de tener permiso antes de realizar cualquier prueba de seguridad hay varias herramientas que nos van a ayudar por ejemplo nosotros ahita vamos a ocupar hra pero hay otras cosas eh lo habíamos platicado hace un par de sesiones pero este es un tipo de ataque activo y no pasivo esto que significa
que hay una interacción con el servicio que vamos a comprometer mediante un intento de autenticación de credenciales Esto va a crear en el log de la máquina remota del servidor e los las bitácoras los logs y ahí nos van a detectar ahí siempre se va a guardar las cosas hasta aquí vamos todo bien básicamente lo que estamos diciendo es que vamos a ocupar algunas herramientas para hacer un ataque diccionario y un ataque diccionario es un refinamiento de un ataque de Fuerza bruta vamos a ocupar contraseñas comunes los demás Gracias Ken los demás
va este perfecto va Aquí se me fue una una diapositiva no terminé Pero tenemos que investigar varias cosas a lo largo que vendo la pra les voy a decir qu es lo que tienen que investigar para que puedan trabajar mejor y también su documentación y ya nos vamos con todo entonces vamos aquí con la la demo al según ya están viendo No mi pantalla
pueden ver exactamente todo lo que yo veo Y eso significa que sí está como en infinito no Estoy compartiendo que Estoy compartiendo que Estoy compartiendo va este bueno Primero que nada tenemos nuestra tenemos un devian está aquí vamos a salir tenemos un este un de que está corriendo y tenemos un Cali que están corriendo en la misma red ambos están en Network eso significa que me asigna que está este dcp activado habilitado entonces me asigna alguna de este segmento qué es lo que voy a hacer primero eh voy a ocupar una herramienta muy
sencilla que se llama nmap y voy a hacer un escaneo al puerto 22 que es el secure shell y voy a hacerlo al segmento que me está diciendo mi virtual Box que tengo que es el 10.03.0 di 24 10.0.3 si no de hecho es muy rápido tend que salir como bastante rapidito y dice que bueno de las 256 IP direcciones ips que escaneo solamente hay cuatro Host arriba Eh tenemos es está cerrado que es el del del punto uno del punto dos está cerrado del punto s está abierto del punto 8 está abierto también quién soy yo yo soy el punto 8 y como nada más hay dos
equipos en mi red Pues voy a suponer que el punto s es el del devian Qué significa que está abierto significa que está escuchando conexiones por ejemplo voy a intentar con el comando de toda la vida secure shell la forma más básica Tom en esta dirección IP y me va a pedir una contraseña Le voy poner Hola va a decir que que no Hola 1 2 3 va a decir que no este Hola con mayúsculas va a decir que no entonces básicamente esto es un ataque diccionario empezar a buscar en el espacio de claves más probable Cuál sería la contraseña de mi
usuario Generalmente es admin o es Root Cuando hice mi mi de se me ocurrió ponerle Tom el usuario pero a lo mejor hubiera sido mejor admin como para ejemplificar que se dej contraseñas y usuarios por defecto Pero pues ni modo en este caso vamos a trabajar con este usuario pero para no tener que hacerlo nosotros a manita cada una de las veces que estamos interactuando con nuestro servicio y literal teniendo que escribir podemos automatizarlo tenemos dos opciones este podemos ocupar hyra que es el que vamos a ocupar
ahorita y tenemos otro aquí pueden ver el manual pueden consultar también el manual y tenemos Cómo se llama crack qué crack map exec Ajá crack map crack Map así se llama no c no enene entrada en el manual no tiene entr manual pas si le damos H Sale yo probé con estas dos herramientas este nos permiten hacer los taques de diccionario cualquiera de las dos Está bien funciona más rápido hra que cck sin embargoes uno recuerden que no nos tenemos que casar con una sola herramienta podemos ocupar varias podemos desarrollar las nuestras en este
caso por facilidad vamos que existe porque el objetivo es conocer los ataques que ocupan No implementar desde cero y pues nada hasta aquí vamos bien vimos muy hasta aquí vamos bien me regreso al chat va ya no p que sí lo demás sí Okay este parte de la investigación que tienen que hacer con para su práctica y lo demás es primero de hecho fue el único que puse en la diapositiva investigar que para queé nos sirve y cómo lo utilizamos en nuestro caso vamos a hacer un escaneo rápido obteniendo versiones rápido significa solo son los
200 puertos más comunes me parece service version de la 10.0.3 7 no que es Nuestro objetivo s esto se puede hacer bastante más complicado pero lo quiero muy sencillo para ejemplificar y Okay qué nos está diciendo desde nuestra máquina atacante a la a nuestro su servidor nos está diciendo que empezó el escaneo deene de escaneo nada más 100 puertos estos puertos son por la opción Fast Pero hay una opción que se llama menos p que es la que acabamos de ocupar hace ratito para hacer el escano sobre todo el segmento de red habíamos puesto
menos p 22 o puerto 22 ahora está ocupando los s más comunes y vemos que el puerto 22 está abierto y el servicio este es secure shell tenemos el puerto 80 que también está abierto Cuál es el servicio que corre por defecto en el puerto 80 pregunta para todos ustedes Julián rosas Ju Miguel Roberto Luis Manuel y Sebastián nos pregunta https qué dicen los demás http https corre por el 443 regreso para acá gracias al que contestó http http se corre por el 443 y en nuestro caso si le hacemos por
ejemplo un pequeño escaneo al puerto 443 nos va a decir que está cerrado Cómo interactúan Cómo podemos interactuar con un http que es una Apache esta versión que corre en devian pregunta para todos Cómo interactúan con có pueden consultar un servicio H Qué es una ap des Gracias desde el navegador podemos consultarlo en este caso pu por la pura IP porque no tiene nombre dominio ni nada si no le pongo así según yo primero inent htp y se redirige a htps o si no encuentra hps Pero lo podemos dar así no más y nos
dice que funciona y esto es porque simplemente es default servidor de web que está instalado no tiene nada más dice que la seguramente porque est viajando claro tenemos esos do ya sabemos este momento que tiene el puerto abierto abierto corendo y8 esta par importante Yo supongo vamos a platicar un poquito después pero Hay muchas formas de atacar un sista aprovecharnos de que este sistema está ocupando contraseñas débiles pero no es la única forma igual podría ser que estamos ocupando una versión de
apche muy desactualizada o una versión de Open muy desactualizada que tien vulnerabilidades conocidas con exploits conocidos Entonces esta información que es la primera etapa del reconocimiento nos permite identificar estas mismas y posiblemente en la etapa de exportación exportar alguna versión que esté vulnerable aquí vamos bien Okay entonces en este momento hicimos un map al sistema exploramos el puerto 80 Entonces vamos a hacer un ataque de diccionario tengo por acá Bueno pasa nada hra la versión la bandera V mayúscula
nos permite ver los cada uno de los intentos usuario contal que está intentado en el sistema la opción F minúscula finaliza una vez que encuentra una válida el usuario ya sabemos que es Tommy el wordlist que voy a ocupar se llama passwords txt y voy a atacar el puerto el perdón el servicio secure shell que como está en el puerto 22 por defecto no tengo que indicarle otra cosa un puerto específico y vamos a pegarle al 10.0.3 de dónde saqué este passwords.
txt ustedes se preguntarán Ah pues miren Es una muy buena pregunta Aquí tengo el password txt si hacemos un World count las líneas del password txt son 251 este passwords txt podemos ver estas contraseñas que estamos acá y el vienen con distribución por defecto aquí en Cali igual las pueden encontrar en Internet por ejemplo aquí tenemos user sh aquí tenemos varias wordl Rock Es una muy grande famosa de antes hay que desempaquetar empaquetada aquí está pesadita lo que ahorita yo hice para este ejemplo Es simplemente irme
a y en lasas de Hay una que se llama está aquí unix passwords password Entonces lo único que hice fue password a de aquí saqu las pequeño ejempo que estamos viendo ahorita vamos todo bien este caso ya las tenemos acá si se damos cuenta Head password txt es lo mismo que tenemos con el de un password simplemente saqu las primeras 250 y pas peño para hacer ese ejercicio si no me equivoco estas son exactamente también las mismas que en rock empieza con las mismas no sé cuál sea las diferencia estaría padre buscarlo Pero bueno hay
muchas y como se pueden dar cuenta son contraseñas que podemos ocupar comunes no admin 1 2 3 4 5 6 1 2 3 4 5 así hasta el nu password password I love you Princess está en inglés más que nada igual podríamos hacer World list específico si el target es en español pero por el momento vamos a ocupar todo esto y pues nada entonces sí Hi todo acá y empezamos nuestro ataque de diccionario noces va a decir que va a empezar como lo acabo de practicar ahorita me va a decir que tengo una una sesión en 10 segundos empieza igual hay
una forma de pasar la bandera para que empiece automáticamente Y entonces aquí está dando los intentos está dando el target nuestro 10.0.7 que es nuestro servidor el usuario Tommy y está intentando cada una de las contraseñas posibles y así nos vamos por ahorita tenemos 252 contraseñas 251 no s ahí pero y aquí y así va a empezar va a empezar a hacer las conexiones va a empezar el proceso de de autenticación lo va a intentar con la contraseña cuando ve que en pues ya cierra la conexión y empieza a empezar vuelve a empezar con otra lo
hace en paralelos entonces hace bastantes conexiones al mismo tiempo y es una de las diferencias que tenemos con con otros por ejemplo igual Tenemos uno con c Map aj Este pero cuando intenté hacer esta Va bastante más lento se cómo se llama esto está este no 10.0.3 mi usuario es tomy y mi password viene de password aquí est Ajá vamos a la diferencia entre estas dos como esta herramienta va más lentito y Aquí vamos con macizo duro rudo incluso aquí tenemos varios errores
pero va esto a qué se debe precisamente yo creo muy probablemente es porque estamos atacando con todo entonces estamos curando nuestro servidor y puede ser que empecemos en una denegación de servicio la denegación de servicio en ataques de este de diccionario puede llegar a ser un problema más cuando atacas con 64 hilos y haces un relajo puedes tirar el servicio eh Para mitigar eso antes lo que yo hacía era darles una IP pública con un servidor que yo tenía arriba y eventualmente me lo tiraban y luego me decían que necesitaba más tiempo que se
había caído entonces para cambiarlo este semestre y que no nos pase eso les voy a dar la la virtual ustedes la virtualiza Y ustedes lo atacan en local y así nos evitamos de problemas y pues miren aquí podemos ver los intentos que está haciendo con cmap exac y Ah ya terminó quería ver cómo terminaba Pero bueno ya intentó las las eh nuestro hyra y podemos ver todos los ats si dan cuenta al final dice Puerto 22 con este Host login tomy pandoras Box es login correcto encontró que estábamos bien sabemos ahora que la contraseña Tom pand box el
servidor vamos bien hasta acá reg para tengo que reiniciar esto porque no da para mucho pero bueno podemos ver aquí la pandoras box Déjenme dejo de compartir reinicio porque creo que mu pero hasta aquí alguna duda deja comentario sugerencia algo va alguien identifica Cuál es una pandoras box de algún lugar
Caja de Pandora inglés y todo junto nadie alguien jugó myology uno de los trucos Dely no equivo era pandoras Box para que te dieran los poderes divinos de forma aleatoria cuando jugabas con trucos no to no bueno bueno va entonces quedamos en que ya
eh obtuvimos la contraseña de tomy y pu Confirmar que ya ven ya va ya vamos hacer tomy a la 10.3.7 nos pregunta contraseña ya sabemos que es pandoras Box ya no somos enali Ahora somos tomy en estamos dentro y aquí podemos haer muchas cosas terminal para los que conocimiento ve quep de antes podríamos practicar versus archivos Okay Ah no tenemos nada pero Okay literalmente estoy dentro aj podemos hacer un eco estoy dentro y guardarlo en pound dxt y por ejemplo Eso es en el Cali eso
es nuestra máquina atacante que estamos a través de la red Aquí esta esta es la de nosotros la del servidor y pues aquí ya aparece TT que no estaba antes estoy dentro literalmente pues ya nos metimos a la cocina eh alguien conoce algún archivo interesante que podos consultar c permisos de archivos instalarle algo por ejemplo Yo supongo que ustedes ya conocen Que en elcp wd están los los usuarios estamos nosos por ejemplo alguien conoce En qué archivos se guardan las emili sabe qué archivos se guardan los este las contraseñas podemos darle c
Shadow por ejemplo permission den qué podemos hacer En este caso pregunta para todos Shadow nos dice que tenemos el que no tenemos permiso para eso podemos intentar levar privilegios podemos ver ide escalar privilegios podemos intentar con sudo para ver si estamos en sudor y y ver si si tenemos permiso o no entonces Vamos a intentarlo con sudo kttc Shadow cuál la contaseña para tomy ya la sabemos pandoras Box Ah sí tenemos si estamos en SW tenemos privilegio de administrador Y esta es la contraseña con su formato este tiene
un formato específico y este formato lo tienen que investigar ustedes Entonces ya vamos dos cosas que tenemos que estudiar primero queé es nmap cómo funciona los modos que tiene para hacer para replicar este este ejercicio después tenemos que estudiar que cómo se guarda la información en el etc Shadow y al momento es todo entonces pues sí literalmente ya nos metimos dentro la cocina podemos hacer lo que queramos podemos hacer un defacement por ejemplo como ya estamos aquí adentro podríamos cambiar el el ese está improvisado ese
no me acuerdo dónde es alguien se acuerda Dónde está el a ver CD tc por acá apach 2 no tengo practicado por eso no sé a ver No aquí no es no es es el aj No no es el bar html El Index nanoex podemos cambiar aquí el donde diga page podemos cambiarlo por cualquier otra cosa está ap 2a page podemos cambiarlo a lo
que quieran no esta página está en el control de los alumnos de criptografía y seguridad Ah pero no lo hice con no lo hice con nanoex html vamos a bajar yo ocupo Nano porque la vieja confiable que nunca falla pero igual si ustedes gustan ocupar otras cosas Está bien lo mismo son un poco más rápidos que yo Pero igual esta página estoy escribiendo sin acentos porque luego cosas rar esta página está en control de los alumnos de y seguridad ahora ahora Entonces ahora podemos dar sudo System control restart Apache no tiene que ser
Apache no restart faltó no eh cómo se llama este este servicio alguien se acuerda Apache 2 no aj esto viene de memoria Entonces ya no me acuerdo muy bien status está corriendo va este ya gracias regresamos Entonces si alguien más ve desde internet nuestra nuestra página pues ya no dice nada pero aquí tendría que decir que esta página está controlada por los alumnos de que los dice segad este porque aquí estamos desde fuera a ver vamos a hacer un cur para ver si este si si nos regresa lo que queremos o no por aquí tía que estar Arribita no esta
página está en el control d o no Sí pero entonces no no es esto el que quería cambiar tengo que cambiar otro no bueno la cosa es que ya ya cambiamos el contenido que está sirviendo el servidor por algo que contramos nosotros porque tenemos acceso desde acá hasta aquí vamos todo bien se entiende Lo que estamos haciendo va entonces eso es como parte del del punto de vista del atacante Pero cómo vemos que estamos siendo objetivos de un ataque diccionario cómo lo podemos checar alguien tiene alguna idea dicen que no los demás tien una idea
Porque si se dan cuenta desde acá no aparece nada el servidor nada más dice login y Incluso si me logo no aparece nada simplemente me está escuchando la pregunta es cómo nos damos cuenta si nosotros somos los administradores del servidor o los defensores que este que alguien está haciendo ataque de diccionario ya ya se fue el ruido de la calle Ay qué feo pero bueno cu te mandan el correo pues pues sí si te hacen un ransomware pues ya te vas a enterar cuando empiecen a paser cosas raras tambén por comportamiento del sistema otra de las
formas es checando las bitácoras hay bitácoras para todo entonces de aquí me voy a salir Entonces ya se cerró la conexión con el servidor otra vez soy Cali Cali y voy a volver a hacer el ataque de diccionario simplemente que ahora quiero que veamos desde la consola del servidor Tom contraseña es pandoras Box escribí mal inus si se dan cuenta podríamos cambiar la contraseña de tomy No desde Cali y así hacer que ya no puedan al sistema desde desde acá Ajá Y aquí podemos ocupar el tengo que tener Ajá sudo journal control es para
verlo continuamente de sh B Entonces vamos a ahorita no hay nada este en la bitácora vamos a repetir el ataque Ah porque aquí no estoy en Ajá aquí el error que me está saliendo es que no en en esa carpeta donde estaba mi home no tengo password.txt entonces me paso a la carpeta donde está mi archivo ya estoy empezando otra vez el ataque de diccionario y aquí podemos ver eh los intentos fallidos entonces aquí pemos ver fail fail password for tomy from la IP y este el puerto entonces aquí claramente que 10.3.8 está causando
ruidos aquí es porque incluso aquí pueden ver vitc te está diciendo cuál es el problema que está ocurriendo y en esos casos aquí se da cuenta hra que no está saliendo bien el ataque entonces empieza a reducir la velocidad y cosas de ese estilo lo que me interesa en este momento es que veamos las bitácoras y vemos pas vemos cómo identificamos si estamos dentro del servidor siendo Defensores que estamos tenendo un ataque dicionario Aquí vemos todos los Esto está en tiempo real entonces aquí estamos viendo lo que está pasando
ambiente real si viéramos tantos tenemos que tomar aluna medida no Y más si todos vimo lugar significa que el atacante tiene Aquí vamos bien Itan pregunta aj Bueno me dijo por los logs anan pregunta y si te cambian la contraseña como admin tendrías que hacer un ataque igual para volver a entrar o ya fuey probablemente ya fue porque si tú vas a cambiar la contraseña como atacante no lo vas a dejar como algo fácil vas a dejar una cadena que no esté en cualquier diccionario y pues ya valió no Aquí empieza tu proceso de respuesta
incidente para ver qué es lo que necesitas hacer F efectivamente F va Entonces vamos a regresarnos al aquí a la presentación vamos a hablar un poquito sobre hardening medas básicas para reforzar la seguridad de Open ssh y Ya pued ahora Estoy compartiendo la presentación se crea una copia de seguridad del archivo de configuración hacemos un copy el archivo de configuración config siempre hacemos una por buenas prácticas de una copia seguridad eso significa que si la regamos podemos regresar la que sabemos que funciona por defecto no con
sud podemos revisar las opciones de configuración predeterminadas actuales e hay que tener cuidado con la edición porque nos podemos quitar el acceso a nosotros mismos si hacemos algo mal entonces hay que revisarlo por eso por buenas prácticas hay que hacer la copia y siempre tenemos que checar las configuraciones predeterminadas y ver que funcione bien antes de hacer el restart de servicio una vez que ya hicimos la copia podemos este trabajar con nuestro editor de texto favorito para modificar la uración deseada ocupo ano no ocupo ano
pero ustedes ocupan otra cosa ocupen otra cosa entonces aquí podemos ver las opciones que tenemos Bueno Este es el el config aquí podemos ver todo lo que está lo que está haciendo lo que no está haciendo lo que está comentado son cosas que no que no están entrando en la configuración lo podemos descomentar lo podemos cambiar una vez Que terminamos de Modificar el el este nuestro nuestras configuraciones con men t minúscula checamos que la sintaxis sea válida y después con reload recargamos otra vez el el servicio de de
secure shelf para que cargue las nuevas configuraciones Cuáles son algunas básicas que tenemos que podemos aplicar permit Root login no esa opción evitará que un atacante inación con el servidor en el servidor directamente como Root No deberíamos poder hacer eso eso fomenta las buenas prácticas de seguridad como realizar tareas comunes con un usuario privilegios todavía pasa que se hacen tareas comunes con siendo Root no eso no Debería ser Únicamente se Tibe ocupar Cuando verdaderamente se necesita entonces esa es clave en
nuestro caso por ejemplo no está habilitado con roots está con Tommy Pero bueno Siempre hay que revisar esto Max tries 3 y este se puede limitar el número máximo de intentos de autenticación para un inicio de decisión particular el valor estándar es el tres pero se configura según el propio umbral de riesgo y esto es cuando nos preg cuando nos cuando desde Cali intentábamos a manita y nos decía mi contraseña que este incorrecta Y te volví a regresar para que volver a escribir entonces este es lo que se refiere el Max outr 3 hay otro que se
llama login Grace Time 20 que son los segundos que un usuario tiene para completar la autenticación después de conectarse inicialmente al servidor y esto nos ayuda a prevenir ataques algunos ataques de negación de servicio en los que se mantienen abiertas varias sesiones durante mucho tiempo Porque podríamos denegar el servicio si ustedes saben el servidor tiene este un cierto número de conexiones que puede tener al mismo tiempo Entonces si todos nosotros intentáramos conectarnos aunque no seamos las contraseña Simplemente nos
conectamos y está esperando por nuestra contraseña y nunca la la ponemos nos puedes como secuestrar la sesión y puede evitar que alguien legítimo eh Te conecte por sec al servidor entonces generamos una deración de servicio y es y es algunas de las que yo hasta no estudiar la configuración básica pues no me planteado ese ejercicio no esa posibilidad de que podías denegar el servicio secuestrando las conexiones Pero bueno password authentication No si se configura la autenticación por vies en lugar de usar contraseñas se se deshabilita la
autenticación por contraseñas para prevenir ataques de diccionario o contraseñas filtradas que es lo que estamos haciendo ahorita en nuestro caso como vamos a ocupar contraseñas pues no podemos poner eso porque si no se cae nuestro ejercicio pero idealmente podemos hacerlo por llaves permit empty password no evitar losos de sesión si la contraseña de un usuario establece como vacía que si no se tiene una política una buena política de contraseñas puede pasar otra interesante es allow users esto restringe la autenticación de usuarios en función del
nombre de usuario y o la dirección por ejemplo y tiene varias formas users anything el wc desde talp o cualquiera desde y el último lo dejas correr desde algún segmento o por usuarios este usuario desde esta IP este otro usuario des IP o únicamente por usuarios Ana y Bob en este caso un ejemplo pero si no no requerimos que Ana se conecte pues nada más dejamos a Bob no por ejemplo otro puede ser por grupos al groups también se puede agregar usuarios seleccionados a un nuevo grupo y permitir que solo este grupo acceda
porsh entonces podemos meter a para no estar este administrando usuario por usuario podemos meter todos los usuarios que requiere meterse a un grupo cuando ya no se requiere simplemente se retira del grupo y solo permitimos que las conexiones se den para los usuarios de grupo client Alive interval el servidor secure shell enviará un mensaje al cliente Si este si no obtiene una respuesta la conexión se cerrará y se cerrará la asociación del usuario y ese es el equivalente a dejar tu computadora abierta y desbloqueada por ahí bueno en
la biblioteca por ejemplo que alguien llegue Ah pues mira está activa entonces pone a hacer algo entonces bueno el clásico no dejar tu tu red social abierta en la papelería para la impresión o algo así entonces hace lo mismo una vez que que si si no empiezas a hacer nada después de cierto tiempo te bota este y también puedes controlar Cuántas veces envía este mensaje de estar vivo antes de desconectarse Finalmente un poquito extra Eh puede ser Ya vimos el puerto predeterminado de CR sl22 la mayoría de las herramientas
automatizadas se escriben para interactuar solo con ese puerto es por eso que si se dan cuenta en el comando que dimos con hra simplemente damos ssh dos puntos diagonal diagonal y la IP y va a intentar por el puerto 22 si tuviéramos otro Puerto abierto tendríamos que indicarle manualmente que el puerto es otro y esto ya con esto reduces bastante los los ataques de diccionario otra forma es hacer fact multifactor se puede combinar este método con una con robusta o autenticación por llaves y esto Agrega una capa de adici idad y el último es
fail to One fail to One es un servicio que comprueba los intentos fallidos de inicio y sesión desde diferentes direcciones IP si estos intentos cruzan un número establecido dentro de un intervalo de tiempo prohíbe que la IP acceda a secure cell durante cierto periodo de tiempo prácticamente Pues los banea por un rato eso es completamente configurable tú decides Por cuánto tiempo los baneas eh Y cuál es el umbral no Si dices No pues más de 10 intentos en un minuto manalo tanto tiempo entonces ya con este le este vuelve
mucho más difícil el ataque diccionario en nuestro caso por ejemplo si teníamos 250 intentos antes de llegar al correcto pues vamos a pasar el tiempo de ejecución del ataque de un minuto Ah en este caso si teníamos 10 intentos lo baneas un minuto pues vamos a tardar bastante más el tiempo que está baneado no y es más difícil poder hacerlo e hasta aquí alguna duda comentario queo sugerencia pregunta y es una pregunta muy interesante de Luis Sebastián si todo esto n más se puede hacer si estás en la misma red de la víctima O puedes hacerlo
desde una red remota a ver qué opinan los demás Qué dicen los demás esto es únicamente estás en en la misma red Yo espero que en la misma red todo depende de cómo esté configurada la red que tienes pero este es un ejercicio interesante por ejemplo déjame Busco algo rápido según yo estamos viendo m No
creo Gracias mira aquí amente busqu conm Puerto abierto y aquí i dom y aquí me está diciendo que es un ssh 2.0 8.9.1 con la versión de ubuntu y los atributos muy probablemente y esto es porque los cers que son de shodan que están desde internet están buscando queé pueros están abiertos y sacando versiones entonces muy probablemente si tú intentas conectarte manualmente con secure shell admin a esta IP o cualquiera de estas porque tenemos 716 resultados te va a contestar pregunta deberían estar abiertos estos puertos ha todo internet
o una red local nada más que no sé si se entiende el cuestionamiento por lo que tú me estás diciendo todo esto se puede hacer si estás en la misma red de la víctima la local o puedo hacerlo desde internet no y aquí estamos desde internet Entonces ustedes diganme vamos a intentar hacer un F cencias a ver si me da eh tenemos 43 en ciencias genómica F ciencias Lia computing científico genética 4 hay otras más versiones por ejemplo esta ya está un poquito más antigua no 6.
7 D habían cco No sé ustedes díganme justamente ya tiré ya tiré el xfc justamente por eso estamos viendo estas cosas porque son cosas que pasan si y es fácil configurarlo y hay varios lugares donde puedes configurarlo no sé desde s desde seguridad perimetral pero incluso desde los mismos H puedes configurarlos para que no te acepten conexiones desde internet si no O sea Habría que ver por ejemplo en este caso genómica fciencias MX es necesario que el puerto 22 esté abierto al mundo probablemente no Probablemente sí hay que ver el caso de uso no y el caso
de que sí tenga que estar expuesto al mundo Qué medidas de seguridad le estamos metiendo que son justo las que acabamos de ver en la en la en la presentación no podemos cambiarle bu el Porto ahí no está cambiado no son 22 pero podríamos cambiar por ejemplo usuarios no podemos que nada más ciertos usuarios puedan conectarse desde ciertas ips estará implementado eso no lo sabemos vamos a probarlo Claro que no porque no tenemos permiso y Recuerden que vimos al principio que tenemos que tener permis hio antes de hacer
cualquier tipo de exploración en estas cosas e qué más me falta Ah podríamos bueno tan necesario creen que sea ver en el servidor los archivos de configuración son estos de acá Bueno es este de acá lo muy necesario me creen o lo hacen ustedes ver este NC ssh sshd config el archivo de configuración de de de ssh Por qué pregunto si no necesario porque justamente en el hardening que son estas configuraciones básicas que podemos hacer estas dónde se hacen se hacen en este archivo de configuración Así se ve con con Nano y es el que
podríamos cambiar nosotros desde Vamos a intentarlo Vamos a intentarlo por ejemplo Déjenme vuelvo a compartir mi Completamente mi para tener el ejemplo para tener el ejemplo bien a ver a ver primero voy a copiar este acá vamos a ver si funciona A ver vamos a ver ejemp Recuerden que primero hay que hacer una copia ya va comp Este Entonces ahora tenemos que
hacer el copy ltc lo vamos a copiar punto Back Back hicimos la copia podemos ver acá tenemos elig el config entonces Ah Podemos editarlo neto esta y aquí vemos el archivo de configuración ustedes pueden checarlo después con calma hay bastantes una que quiera ver importante Entonces era users
users lo que no sé si es permi o prohibitivo la política pero vamos a experimentar aquí podos cambiar a users esbe Así es así con mayúscula tomy desde la bueno cualquiera cualquier usuario ns estoy yo pero desde la 10.0 3.9 que soy yo vamos a ver qué pasa bueno no yo soy la Bueno yo esty la 7 pero voy a ponerle otra para ver qué pasa entonces podemos darle sudo men t minúscula para ver que esté bien cuál era A ver es es HD no porque es parece que todo está bien todo sudo System control System ctl este reload ssh estatus
ahora estatus ya está corriendo Entonces vamos a ver desde la máquina Qué pasa si lo intento conectar sí me está dejando pasar todavía entonces por ejemplo ahí podemos ver que esa política no es prohibitiva Y eso significa que no es bloquea todo excepto esto sino que estás dando autorización específicamente para algún segmento en este caso cualquiera desde un IP eso se entendió más o menos lo que se hizo tengo un procesando los demás ya me ya ya ya no ya no saben ni qué estoy haciendo desde hace ratito sí no más o
menos va le di permiso a Tommy desde una IP que fue lo que acaba de hacer pero eh Como estoy permitiendo a ver cómo explicarlo otra vez tenemos varias políticas una es permitividad de de este de de autenticarse le dis permiso a cierto usuario desde cierta IP autenticarse que es a users pero al momento como da permiso a todos le vi como ya el umbral más grande es todos tienen permiso este usuario tiene permiso Pues de Por qué manera va a pasar no si me Okay me puedo bloquear el permiso sí pero Déjame revisar rápido que den users no A ver déjame
googlear rápido este users a ver Din users a hay uno que se llama users Déjenme cambiarlo ten verdad para que se vea que estoy haciendo Voy a segú Yo ya me bloqueé déjame compartir to mi pantalla y ver qué pasa me ven
ya este lo que hice aquí fue ahora le puse users tomy puede ver aquí chiquito Entonces se supone que ya cambi la directiva que no permita al usuario Tom conectarse después vi que la configur estua bien hecha recargué el servicio vi que est corriendo y ahora sería interesante ver desde acá Qué pasa cuando me intento conectar Mira no me está haciendo caso por algún motivo A ver Mira justo me deja conectarme Pero cuando me pide por mi contraseña No me la no me deja pleas TR Entonces ya no puedo conectarme desde afuera entonces de aquí ya ya me quité
el acceso desde fuera Creo que este está mejor no para para ejemplificar las configuraciones del de acá Ajá cuando checamos con Nano justamente viene hasta abajo aquí tenemos muchas configuraciones que hacer aquí está lo de login Grace Time permit login Max Max sessions public authentication Yes todo esto está comentado porque no está no está en la configuración pero hasta el último puse deny users tomy y es esa configuración la que al final cuando yo intento hacer un ataque desde acá me dice que no que no funciona Incluso si yo volviera a
correr mi mi ataque de diccionario va a decir que no va a correr todo y me va a decir que al final que no podemos verlo también en sudo jal aquí no está tan lejos aquí y aquí de plano me dice Bueno me va a parecer lo mismo de que son los los los inválidos porque si lo está intentando pero la configuración de del servicio pues está que no que ese usuario no no puede conectarse ya así nos podemos 252 y nos va a decir que no esperamos un minutito para que termine y nos diga al final que noos hacer más rápido vamos hacer como
password le podemos poner la password en minúscula pandoras Box así ver Ahí está entonces ahora no encontró ninguna contraseña válida Por más que sabemos que esta es la buena por qué Porque ya está deshabilitado en nuestro en nuestro servidor que el usuario Tom no puede autenticarse va hasta el momento alguna queja comentario duda sugerencia todo bien los demás creo que no Cuál va a ser la práctica vamos a practicar un ataque de diccionario pueden ocupar cckm o pueden ocupar hydra eh les voy a pasar la imagen tienen que bueno la
virtual tienen que correr la virtual tienen que escanar el segmento de red en el que se encuentren obtener la IP empezar a hacer los ataques de diccionario yo les voy a pasar el wordlist para que tampoco sea tan tan complicado probablemente sea una de las que están ya en Cali e y al final simplemente tiene que documentar su proceso y ver cómo cómo le dan algo interesante es que les voy a pasar todos a todos les voy a pasar la misma bueno todo el grupo va a tener la misma virtual Entonces si se dan cuenta acabamos de platicar Cómo podemos sacar
las contraseñas del etc Shadow Por eso quiero que lo investiguen porque en verdad podría un equipo el primer equipo que lo atine podría entrar al sistema eh sacar el etc Shadow Y luego craquear el Hash con la sal que tiene Sabiendo ya el diccionario y así nos ahorramos el ataque de diccionario el ataque de diccionario es más lento que romper la la la contraseña cifrada o jada no está cifrada está jada que romper la contraseña hasada Porque no tenemos que esperar la conexión y todo eso que involucre un rollo simplemente ensayo roll ror hasta
romperla se entiende Esta última parte o alguien de plan no tiene idea de qué es lo que acabo de decir puedo repetir Luis Sebastián tampoco entendió Okay voy otra vez e al final cuando yo voy a pasar esta virtual va a estar así para todos cuando la arranquen va a decir Dean login por ejemplo creo que ahorita es como hir no es un equipo que se llama hir hir No sé si l k pero hir va a preguntar la contraseña de hir no me la sé no De hecho ni siquiera este usuario Entonces no me va a dejar pasar va a decir que este Qué pasa
cuando yo que soy usuario tomy que mi equipo es Tommy le atino a mi contraseña y entro al sistema bueno puedo checar un etc pas wd y ahorita nada más aparece aquí al final Pues yo Tommy pero en la virtual que les voy a pasar van a aparecer todos ustedes por equipos va a aparecer va a aparecer es que nada me acuerdo de hir pero este todos los equipos tienen que aparecer aquí listados entonces también les dije que pueden investigar Bueno les dije que tienen que investigar elc Shadow porque aquí en ltc Shadow aparece la contraseña
hasada no les voy a dar más contexto ahorita pero aquí tend aquí como ven Tommy tendrían que ver también de todos los demás usuarios por ejemplo aquí podemos ver igual puedo investigar qué significa que con r tenga una admiración en vez de un asterisco o en vez de un Hash eso qué significa eso van a tener que en la práctica entonces una vez que saquen estos de acá pues pueden compartirlo entre ustedes y ya no tienen que hacer el ataque probando por ensayo y error uno a uno sino podrían encontrar algo que les ayude a romper estos hashes para
o encontrar la contraseña correcta No creo que ya lo expliqué mejor pero eso es parte de la investigación que tienen que hacer pues es parte de su práctica se entendió igual puede no compartirse nada y cada quien cada equipo hacerlo por su cuenta pero en caso de que se pueda pues ya mejor sí no O sea si pueden por ataque dicionario tranquilamente cada uno de los equipos sacar su contraseña pero digo si quieren buscarle más pues podrían investigar Bueno aú voy de que lo investiguen pero podrí investigar que es Shadow y si lo tienes y tienes un
Word probable Cómo hacer para obtener la contraseña correcta este pues va dejo de grabar aquí llegamos Ah no es cierto Todavía no puedo dejar de grabar por favor actualicen en el en el Google docs que tenemos los nombres de los equipos porque de ahí voy a sacar los equipos entonces si alguien no está en este en ese archivo pues no no lo voy a poder meter como usuario e Entonces nada más chequen eso no que es igual comentado de la clase pasada que tenían que que actualizar sus nombres de equipos ahora sí ya dejo de grabar Eso
es para los que no están acá y alguno de los que quedan Tienen alguna queja comentario duda algo que hay hecho falta nos fuimos más lento que la vez pasada bastante más lento ahora lo expliqué a fondo pero ustedes díganme o vamos sí tiene que ver con sí es un Hash tiene que ver sí tiene que ver con sal y con cosas así una estructura puntitos los demás Todo bien por el momento todo bien va entonces actualicen sus sus equipos yo creo que al rato Mañana probablemente mañana lo suba les digo el worklist donde tienen que
practicarlo y ya eso sería todo por por la práctica y por el laboratorio todo bien perfecto Vale Nos vemos gracias por venir gracias muchas gracias Sara José anan Melisa Luis Carlos gracias Buen día nos vemos Dios queo Jorge Jonathan
